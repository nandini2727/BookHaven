{% extends "base.html" %}
{% load static %}
    {% block title %}<title>Book Shop</title>{% endblock title %}
    {% block static %}
    <link rel="stylesheet" href="{% static 'css/shop.css' %}">
    {% endblock static %}
   
</head>
    {% block body %}
    <body>
        <!-- Shop Section -->
        <h1>Shop Books</h1>
        <div class="shop-page">
            <!-- Filters Section -->
            <div class="filters">
                <h2>Filters</h2>
        
                <!-- Format Filter -->
                {% comment %} <div class="filter">
                    <label>Format:</label>
                    <select id="format-filter" onchange="this.form.submit()">
                        <option value="all" {% if selected_format == 'all' %}selected{% endif %}>All</option>
                        <option value="ebook" {% if selected_format == 'ebook' %}selected{% endif %}>E-Book</option>
                        <option value="hardcopy" {% if selected_format == 'hardcopy' %}selected{% endif %}>Hardcopy</option>
                    </select>
                </div> {% endcomment %}
        
                <!-- Category Filter -->
                <form method="get" action="{% url 'shop' %}" id="category-filter-form">
                    <label for="category">Filter by Category:</label>
                    <select name="category" id="category" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if category.id == selected_category %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                </form>
        
                <!-- Price Range Slider -->
                <div class="filter">
                    <label>Price Range: <span id="price-range-value">${{ price_range }}</span></label>
                    <input type="range" id="price-range" name="price" min="0" max="100000" value="{{ price_range }}" step="1" onchange="updatePriceValue()">
                </div>
        
                <!-- Sorting -->
                <div class="filter">
                    <label>Sort By:</label>
                    <select id="sort-filter" onchange="this.form.submit()">
                        <option value="popularity" {% if sort_by == 'popularity' %}selected{% endif %}>Popularity</option>
                        <option value="price-low" {% if sort_by == 'price-low' %}selected{% endif %}>Price: Low to High</option>
                        <option value="price-high" {% if sort_by == 'price-high' %}selected{% endif %}>Price: High to Low</option>
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest</option>
                    </select>
                </div>
            </div>
        
            <!-- Books Listing -->
            <div class="books-container" id="books-container">
                {% for book in books %}
                <div class="book-card">
                    <img src="{{ book.cover_image }}" alt="{{ book.title }}" loading="eager">
                    <h3>{{ book.title }}</h3>
                    <p>Author: {{ book.author }}</p>
                    <p>Category: {{ book.category.name }}</p>
                    <p>Price: ₹{{ book.price }}</p>
                    <p>Popularity: {{ book.popularity }}</p>
                    <p>Added on: {{ book.created_at }}</p>
                    {% if book.stock == 0 %}
                         <p class="out-of-stock" >Out Of Stock</p>
                    {% else %}
                        <button class="add-to-cart" data-book-id="{{ book.id }}"><a href="{% url 'add_to_cart' book.id %}" >Add to Cart</a></button>
                    {% endif %}
                    <button class="wishlist" ><a href="{% url 'add_to_wishlist' book.id %}" >Wishlist</a></button>
                </div>
                {% endfor %}
            </div>
        
        </div>
        
        <!-- Pagination -->
        <div class="pagination">
            <span>Page {{ books.number }} of {{ books.paginator.num_pages }}</span>
            {% if books.has_previous %}
            <button class="prev-btn" onclick="window.location='?page={{ books.previous_page_number }}'">❮ Previous</button>
            {% else %}
                <button class="prev-btn" disabled>❮ Previous</button>
            {% endif %}
                {% if books.has_next %}
                <button class="next-btn" onclick="window.location='?page={{ books.next_page_number }}'">Next ❯</button>
            {% else %}
                <button class="next-btn" disabled>Next ❯</button>
            {% endif %}
        </div> 
        
        <script>
            // Update price range display
            function updatePriceValue() {
                const priceRange = document.getElementById('price-range').value;
                document.getElementById('price-range-value').textContent = 'Rs.' + priceRange;
                document.getElementById('category-filter-form').submit();
            }
        
            // Add to cart button functionality (basic demo)
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const bookId = this.getAttribute('data-book-id');
                    alert('Book with ID ' + bookId + ' added to the cart!');
                    // You can handle cart functionality here using JavaScript and Django's session or a cart model
                });
            });
        </script>        
    </body>
    {% endblock body %}
</html>
